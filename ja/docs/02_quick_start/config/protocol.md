---
title: プロトコルエンドポイント設定ガイド
description: Nekro Agentのプロトコルエンドポイント設定の詳細説明。NapCat統合デプロイ、その他のプロトコルエンドポイントの接続方法、およびトラブルシューティングを含みます。
---

# プロトコルエンドポイント設定

Nekro Agentは、複数のOneBot V11互換のプロトコルエンドポイント接続方法をサポートしています。このドキュメントでは、異なるプロトコルエンドポイントを設定する方法を紹介します。

## NapCat統合デプロイ（推奨）

[NapCat](https://github.com/NapNeko/NapCatQQ)は、最新のQQNTベースのBotプロトコルエンドポイント実装です。NapCatデプロイを含むワンクリックスクリプトを使用した場合、ステップ4に直接スキップし、Tokenを使用してNapCatにログインし、手順に従ってWebsocketクライアントを設定してください。

::: warning 警告！

1. NapCatのデフォルトパスワードを必ず変更してください：パブリックWebUIでは強力なパスワードを使用する必要があります（12文字以上の数字、文字、記号を含むことを推奨）
2. Token認証を必ず使用してください：OneBotサービスは有効なTokenを設定する必要があり、空のTokenや弱いパスワードは避けてください
3. セキュリティ上の理由から、デフォルトポートの使用は避けてください

:::

#### 設定手順

::: warning 注意

1. 以下の手順では、デフォルトのインストール設定を例として使用します。デプロイ中にポートを変更した場合は、手順内の8021と6099のポートを実際のポート番号に置き換えてください
2. クラウドサーバーを使用してデプロイした場合、クラウドサーバーのセキュリティグループでポート8021と6099（または変更したポート）を先に開けてください

:::

1. Nekro Agent WebUIを開きます：`http://<あなたのサービスIP>:8021`
2. インストールスクリプトで提供されたアカウントとパスワードを使用してログインします
3. NapCatを設定します：

   - デフォルトでは、NapCat WebUIアドレスは`http://<あなたのサービスIP>:6099/webui`であるはずです（「システム設定」→「基本設定」で変更可能）
   - 「プロトコルエンドポイント」→「NapCat」→「WebUI」で、ページ上部に表示されるTokenを使用してログインし、Botとして使用する必要のあるQQアカウントにログインします
   - 「ネットワーク設定」でWebsocketクライアントを追加します：
     - URLを追加：`ws://nekro_agent:8021/onebot/v11/ws`（URLはコンテナネットワーク通信を使用し、ポートを変更したかどうかに関係なくこのアドレスを使用します）
     - OneBotアクセスキーを設定します。これはこのページの上部に表示される`OneBotアクセスキー`で、コピーして入力するだけです
     - 「有効にする」スイッチをオンにして保存します

設定が完了したら、[システム設定ガイド](/ja/docs/02_quick_start/config/system.html)ドキュメントを参照して、基本アプリケーション設定を続行し、使用を開始してください

### その他のプロトコルエンドポイント

その他のプロトコルエンドポイントを使用した場合、リバースWebSocketアドレスを`ws://<あなたのサービスIP>:8021/onebot/v11/ws`に設定して、NekroAgentに接続し、使用を開始してください

:::warning
その他のプロトコルエンドポイントを使用する場合、NekroAgentデータマウントディレクトリを自分で設定する必要があります。そうしないと、画像、ファイル、その他のリソースを正常に送受信できない場合があります
:::

## トラブルシューティング

### 接続の問題

- **接続失敗**：ネットワーク接続とファイアウォール設定を確認してください
- **認証失敗**：OneBotサービスアクセスキーが正しく設定されているか確認してください（NekroAgentのWebUI「プロトコルエンドポイント」→「NapCat」→「WebUI」で取得）

### メッセージ受信の問題

- **メッセージが受信できない**：両端のログを確認し、接続が正しく確立されているか確認してください（NekroAgentシステムログに`connection open`と表示されます）
- **メッセージフォーマットエラー**：互換性のあるOneBot実装を使用しているか確認してください