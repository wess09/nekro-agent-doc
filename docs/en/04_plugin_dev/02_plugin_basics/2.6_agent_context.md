---
title: Agent ä¸Šä¸‹æ–‡ (AgentCtx)
description: æ·±å…¥äº†è§£ Nekro Agent æ’ä»¶å¼€å‘ä¸­çš„æ ¸å¿ƒä¸Šä¸‹æ–‡å¯¹è±¡ AgentCtxï¼ŒåŒ…æ‹¬å…¶å±æ€§ã€æ–¹æ³•å’Œåœ¨æ’ä»¶ä¸­çš„ä½¿ç”¨æ–¹å¼
---

# Agent ä¸Šä¸‹æ–‡ (AgentCtx)

`AgentCtx` æ˜¯ Nekro Agent æ’ä»¶å¼€å‘ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚å®ƒå°è£…äº† Agent åœ¨æ‰§è¡Œä»»åŠ¡æ—¶æ‰€éœ€çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸ºæ’ä»¶æä¾›äº†ç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®ç›¸å…³æ•°æ®å’ŒåŠŸèƒ½ã€‚

## ä»€ä¹ˆæ˜¯ AgentCtxï¼Ÿ

`AgentCtx`ï¼ˆAgent Contextï¼‰æ˜¯ä¸€ä¸ªåŒ…å«äº†å½“å‰æ‰§è¡Œç¯å¢ƒæ‰€æœ‰å…³é”®ä¿¡æ¯çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚æ— è®ºæ˜¯å¤„ç†æ¥è‡ªèŠå¤©è½¯ä»¶çš„æ¶ˆæ¯ï¼Œè¿˜æ˜¯å“åº” Webhook äº‹ä»¶ï¼Œ`AgentCtx` éƒ½æä¾›äº†ç»Ÿä¸€çš„æ¥å£è®©æ’ä»¶ä¸ Nekro Agent çš„æ ¸å¿ƒåŠŸèƒ½è¿›è¡Œäº¤äº’ã€‚

åœ¨æ’ä»¶å¼€å‘ä¸­ï¼Œ`AgentCtx` é€šå¸¸ä½œä¸ºæ²™ç›’æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆçº¦å®šä½¿ç”¨ `_ctx` ä½œä¸ºå˜é‡åï¼‰æä¾›ç»™æ’ä»¶ä½¿ç”¨ã€‚

## æ ¸å¿ƒå±æ€§

### åŸºæœ¬ä¿¡æ¯å±æ€§

```python
# æ²™ç›’å’ŒèŠå¤©æ ‡è¯†
_ctx.from_chat_key: Optional[str]     # æ¥æºèŠå¤©çš„å”¯ä¸€æ ‡è¯†
_ctx.chat_key: Optional[str]          # èŠå¤©é¢‘é“å”¯ä¸€ID (åŒ from_chat_key)
_ctx.container_key: Optional[str]     # æ²™ç›’å®¹å™¨çš„å”¯ä¸€æ ‡è¯†

# èŠå¤©é¢‘é“ä¿¡æ¯
_ctx.channel_id: Optional[str]        # é¢‘é“çš„åŸå§‹å¹³å° IDï¼ˆå¦‚ QQ ç¾¤å·æˆ–ç”¨æˆ· IDï¼‰
_ctx.channel_name: Optional[str]      # é¢‘é“åç§°ï¼ˆå¦‚ QQ ç¾¤åæˆ–ç”¨æˆ·åï¼‰
_ctx.channel_type: Optional[str]      # é¢‘é“ç±»å‹ï¼ˆå¦‚ 'group' æˆ– 'private'ï¼‰
_ctx.adapter_key: Optional[str]       # é€‚é…å™¨æ ‡è¯†ï¼ˆå¦‚ 'onebot_v11'ï¼‰

# Webhook ç›¸å…³ï¼ˆå½“ç”± Webhook è§¦å‘æ—¶ï¼‰
_ctx.webhook_request: Optional[WebhookRequest]  # Webhook è¯·æ±‚æ•°æ®
```

### é‡è¦å±æ€§è®¿é—®å™¨

#### `chat_key` å±æ€§

```python
@property
def chat_key(self) -> str:
    """èŠå¤©é¢‘é“å”¯ä¸€ID"""
```

è¿™æ˜¯å½“å‰èŠå¤©é¢‘é“çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç”± `adapter_key` å’Œ `channel_id` ç»„æˆã€‚

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.TOOL, "get_chat_info", "è·å–å½“å‰èŠå¤©é¢‘é“ä¿¡æ¯")
async def get_chat_info(_ctx: AgentCtx) -> str:
    return f"å½“å‰èŠå¤©é¢‘é“: {_ctx.chat_key}"
    # è¾“å‡ºç¤ºä¾‹: "å½“å‰èŠå¤©é¢‘é“: onebot_v11-group_12345678"
```

#### `adapter` å±æ€§

```python
@property
def adapter(self) -> "BaseAdapter":
    """æ¶ˆæ¯å…³è”é€‚é…å™¨å®ä¾‹"""
```

é€šè¿‡æ­¤é€‚é…å™¨å®ä¾‹ï¼Œæ’ä»¶å¯ä»¥è·å–é€‚é…å™¨ç›¸å…³ä¿¡æ¯æˆ–è°ƒç”¨é€‚é…å™¨ç›¸å…³æ–¹æ³•ã€‚

#### `db_chat_channel` å’Œ `db_user` å±æ€§

```python
@property
def db_chat_channel(self) -> Optional["DBChatChannel"]:
    """å½“å‰èŠå¤©é¢‘é“çš„æ•°æ®åº“å®ä¾‹"""

@property
def db_user(self) -> Optional["DBUser"]:
    """è§¦å‘æœ¬æ¬¡ Agent çš„æ•°æ®åº“ç”¨æˆ·å®ä¾‹"""
```

è¿™äº›å±æ€§æä¾›å¯¹åº•å±‚æ•°æ®åº“æ¨¡å‹çš„è®¿é—®ï¼Œç”¨äºé«˜çº§æ•°æ®æ“ä½œã€‚

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### æ–‡ä»¶ç³»ç»Ÿ (`fs`)

`_ctx.fs` æä¾›äº†å¼ºå¤§çš„æ–‡ä»¶å¤„ç†èƒ½åŠ›ï¼Œç”¨äºåœ¨æ’ä»¶å’Œ AI ä¹‹é—´å®‰å…¨åœ°ä¼ é€’æ–‡ä»¶ã€‚

```python
@property
def fs(self) -> FileSystem:
    """æ–‡ä»¶ç³»ç»Ÿå·¥å…·"""
```

**ä¸»è¦æ–¹æ³•ï¼š**

#### `mixed_forward_file` - æ’ä»¶å‘ AI ä¼ é€’æ–‡ä»¶

å½“æ’ä»¶éœ€è¦ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€æ–‡æ¡£ï¼‰å¹¶è¿”å›ç»™ AI æ—¶ä½¿ç”¨ï¼š

```python
@plugin.mount_sandbox_method(SandboxMethodType.TOOL, "generate_chart", "ç”Ÿæˆå›¾è¡¨å¹¶è¿”å›ç»™AI")
async def generate_chart(_ctx: AgentCtx, data: str) -> str:
    # æ’ä»¶é€šè¿‡ API è·å–äº†ä¸€å¼ å›¾ç‰‡
    image_url = "https://example.com/chart.png"

    # å°†å…¶è½¬æ¢ä¸º AI å¯ç”¨çš„æ²™ç›’è·¯å¾„
    sandbox_path = await _ctx.fs.mixed_forward_file(image_url, file_name="chart.png")

    # è¿”å›æ²™ç›’è·¯å¾„ç»™ AI
    return sandbox_path  # "/app/uploads/chart.png"
```

#### `get_file` - AI å‘æ’ä»¶ä¼ é€’æ–‡ä»¶

å½“ AI è°ƒç”¨æ’ä»¶å¹¶ä¼ å…¥ä¸€ä¸ªæ²™ç›’æ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°æ—¶ï¼Œæ’ä»¶ä½¿ç”¨æ­¤æ–¹æ³•è·å–å®¿ä¸»æœºä¸Šçš„çœŸå®è·¯å¾„ï¼š

```python
@plugin.mount_sandbox_method(SandboxMethodType.TOOL, "analyze_image", "åˆ†æå›¾ç‰‡å†…å®¹")
async def analyze_image(_ctx: AgentCtx, image_path: str) -> str:
    # AI æä¾›çš„æ²™ç›’è·¯å¾„: "/app/shared/photo.jpg"
    # è½¬æ¢ä¸ºå®¿ä¸»æœºå¯è®¿é—®çš„çœŸå®è·¯å¾„
    host_path = _ctx.fs.get_file(image_path)

    # ç°åœ¨å¯ä»¥è¯»å–æ–‡ä»¶äº†
    with open(host_path, "rb") as f:
        file_content = f.read()
        # è¿›è¡Œå›¾ç‰‡åˆ†æ...

    return "å›¾ç‰‡åˆ†æå®Œæˆ"
```

### æ¶ˆæ¯æ¨¡å— (`ms`)

`_ctx.ms` æä¾›å¯¹åº•å±‚æ¶ˆæ¯æ¨¡å—çš„ç›´æ¥è®¿é—®ï¼Œä¸»è¦ç”¨äºéœ€è¦æ‰‹åŠ¨æŒ‡å®š `chat_key` çš„é«˜çº§åœºæ™¯å’Œä¸»åŠ¨è§¦å‘ AI å“åº”ã€‚

```python
@property
def ms(self):
    """æ¶ˆæ¯æ¨¡å—"""
```

**ä¸»è¦æ–¹æ³•ï¼š**

#### `send_text` - å‘æŒ‡å®šé¢‘é“å‘é€æ–‡æœ¬æ¶ˆæ¯

```python
async def send_text(self, chat_key: str, content: str, ctx: AgentCtx) -> None:
    """å‘æŒ‡å®šèŠå¤©é¢‘é“å‘é€æ–‡æœ¬æ¶ˆæ¯"""
```

#### `push_system` - æ¨é€ç³»ç»Ÿæ¶ˆæ¯å¹¶è§¦å‘ AI å“åº”

```python
async def push_system(self, chat_key: str, message: str, ctx: AgentCtx, trigger_agent: bool = False) -> None:
    """å‘ç³»ç»Ÿæ¨é€æ¶ˆæ¯ï¼Œå¯é€‰æ‹©æ˜¯å¦è§¦å‘ AI å“åº”"""
```

**å‚æ•°è¯´æ˜ï¼š**

- `chat_key`: ç›®æ ‡èŠå¤©é¢‘é“æ ‡è¯†
- `message`: è¦æ¨é€çš„ç³»ç»Ÿæ¶ˆæ¯å†…å®¹
- `ctx`: Agent ä¸Šä¸‹æ–‡
- `trigger_agent`: æ˜¯å¦è§¦å‘ AI ç”Ÿæˆå›å¤ï¼ˆé»˜è®¤ Falseï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**

**å‘å…¶ä»–èŠå¤©é¢‘é“å‘é€æ¶ˆæ¯**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "notify_admin", "é€šçŸ¥ç®¡ç†å‘˜")
async def notify_admin(_ctx: AgentCtx, message: str) -> str:
    # å‘ç›‘æ§é¢‘é“å‘é€çŠ¶æ€æ›´æ–°
    monitor_chat_key = "onebot_v11-group_987654321"

    await _ctx.ms.send_text(monitor_chat_key, f"ç³»ç»Ÿé€šçŸ¥: {message}", _ctx)

    return "å·²é€šçŸ¥ç®¡ç†å‘˜"
```

**è·¨èŠå¤©é¢‘é“è§¦å‘ AI å“åº”**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "report_to_monitoring", "æŠ¥å‘Šåˆ°ç›‘æ§ç¾¤")
async def report_to_monitoring(_ctx: AgentCtx, incident: str) -> str:
    # å‘ç›‘æ§ç¾¤æ¨é€äº‹ä»¶å¹¶è§¦å‘ AI åˆ†æ
    monitoring_chat = "onebot_v11-group_monitor123"
    analysis_prompt = f"æ£€æµ‹åˆ°ç³»ç»Ÿäº‹ä»¶ï¼š{incident}\nè¯·åˆ†æå½±å“å¹¶æä¾›å¤„ç†å»ºè®®ã€‚"

    await _ctx.ms.push_system(
        chat_key=monitoring_chat,
        message=analysis_prompt,
        ctx=_ctx,
        trigger_agent=True  # è§¦å‘ç›‘æ§ç¾¤ä¸­çš„ AI åˆ†æ
    )

    return "å·²æŠ¥å‘Šåˆ°ç›‘æ§ç¾¤ï¼ŒAI æ­£åœ¨åˆ†æ"
```

## ä¾¿æ·æ–¹æ³•

### æ¶ˆæ¯å‘é€æ–¹æ³•

#### `send_text` - å‘é€æ–‡æœ¬æ¶ˆæ¯

```python
async def send_text(self, content: str, *, record: bool = True):
    """å‘é€æ–‡æœ¬æ¶ˆæ¯åˆ°å½“å‰èŠå¤©é¢‘é“"""
```

**å‚æ•°è¯´æ˜ï¼š**

- `content`: è¦å‘é€çš„æ–‡æœ¬å†…å®¹
- `record`: æ˜¯å¦è®°å½•åˆ°å¯¹è¯å†å²ï¼ˆé»˜è®¤ Trueï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "send_notification", "å‘é€é€šçŸ¥")
async def send_notification(_ctx: AgentCtx, message: str) -> str:
    await _ctx.send_text(f"ğŸ“¢ é€šçŸ¥: {message}")
    return "é€šçŸ¥å·²å‘é€"
```

#### `send_image` - å‘é€å›¾ç‰‡

```python
async def send_image(self, file_path: str, *, record: bool = True):
    """å‘é€å›¾ç‰‡åˆ°å½“å‰èŠå¤©é¢‘é“"""
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "send_chart", "å‘é€å›¾è¡¨")
async def send_chart(_ctx: AgentCtx, chart_url: str) -> str:
    # è½¬æ¢ä¸ºæ²™ç›’è·¯å¾„
    image_path = await _ctx.fs.mixed_forward_file(chart_url, file_name="chart.png")

    # å‘é€å›¾ç‰‡
    await _ctx.send_image(image_path)

    return "å›¾è¡¨å·²å‘é€"
```

#### `send_file` - å‘é€æ–‡ä»¶

```python
async def send_file(self, file_path: str, *, record: bool = True):
    """å‘é€æ–‡ä»¶åˆ°å½“å‰èŠå¤©é¢‘é“"""
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "send_report", "å‘é€æŠ¥å‘Š")
async def send_report(_ctx: AgentCtx, report_content: str) -> str:
    # åœ¨å…±äº«ç›®å½•åˆ›å»ºæ–‡ä»¶
    file_on_host = _ctx.fs.shared_path / "report.txt"
    with open(file_on_host, "w", encoding="utf-8") as f:
        f.write(report_content)

    # è½¬æ¢ä¸ºæ²™ç›’è·¯å¾„
    file_path = _ctx.fs.forward_file(file_on_host)

    # å‘é€æ–‡ä»¶
    await _ctx.send_file(file_path)

    return "æŠ¥å‘Šå·²å‘é€"
```

#### `push_system` - å‘å½“å‰é¢‘é“æ¨é€ç³»ç»Ÿæ¶ˆæ¯

```python
async def push_system(self, message: str, *, trigger_agent: bool = False):
    """å‘å½“å‰èŠå¤©é¢‘é“æ¨é€ç³»ç»Ÿæ¶ˆæ¯ï¼Œå¯é€‰æ‹©æ˜¯å¦è§¦å‘ AI å“åº”"""
```

**å‚æ•°è¯´æ˜ï¼š**

- `message`: è¦æ¨é€çš„ç³»ç»Ÿæ¶ˆæ¯å†…å®¹
- `trigger_agent`: æ˜¯å¦è§¦å‘ AI ç”Ÿæˆå›å¤ï¼ˆé»˜è®¤ Falseï¼‰

è¿™æ˜¯ `_ctx.ms.push_system()` çš„ä¾¿æ·å½¢å¼ï¼Œè‡ªåŠ¨ä½¿ç”¨å½“å‰çš„ `chat_key`ã€‚

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "schedule_analysis", "å®šæ—¶åˆ†æ")
async def schedule_analysis(_ctx: AgentCtx, report_data: str) -> str:
    # å¼‚æ­¥è§¦å‘å½“å‰ä¼šè¯çš„ AI åˆ†æï¼ˆæ¯”å¦‚å®šæ—¶ä»»åŠ¡å®Œæˆåï¼‰
    analysis_prompt = f"å®šæ—¶æ•°æ®æ”¶é›†å®Œæˆï¼Œä»¥ä¸‹æ˜¯æŠ¥å‘Šæ•°æ®ï¼š\n{report_data}\nè¯·åˆ†æå¹¶æ€»ç»“è¦ç‚¹ã€‚"

    await _ctx.push_system(analysis_prompt, trigger_agent=True)

    return "æ•°æ®æ”¶é›†å®Œæˆï¼ŒAI åˆ†æå·²å¯åŠ¨"

@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "cross_chat_notify", "è·¨ç¾¤é€šçŸ¥")
async def cross_chat_notify(_ctx: AgentCtx, target_chat: str, event: str) -> str:
    # å‘å…¶ä»–èŠå¤©ç¾¤æ¨é€äº‹ä»¶å¹¶è§¦å‘ AI å¤„ç†
    notification = f"æ¥è‡ª {_ctx.channel_name} çš„äº‹ä»¶é€šçŸ¥ï¼š{event}\nè¯·è¯„ä¼°æ­¤äº‹ä»¶çš„é‡è¦æ€§ã€‚"

    await _ctx.ms.push_system(
        chat_key=target_chat,
        message=notification,
        ctx=_ctx,
        trigger_agent=True
    )

    return f"å·²å‘ {target_chat} å‘é€äº‹ä»¶é€šçŸ¥"
```

## é…ç½®è®¿é—®

### `get_core_config` - è·å–æ ¸å¿ƒé…ç½®

```python
async def get_core_config(self) -> CoreConfig:
    """è·å–å½“å‰ç”Ÿæ•ˆçš„æ ¸å¿ƒé…ç½®å®ä¾‹"""
```

æ ¸å¿ƒé…ç½®ç”±ä¸‰å±‚é…ç½®æ··åˆç”Ÿæˆï¼šç³»ç»ŸåŸºæœ¬è®¾å®š â†’ é€‚é…å™¨è®¾å®š â†’ èŠå¤©é¢‘é“è®¾å®šï¼Œä¼˜å…ˆçº§ä¾æ¬¡é€’å¢ã€‚

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.TOOL, "check_cloud_status", "æ£€æŸ¥äº‘æœåŠ¡çŠ¶æ€")
async def check_cloud_status(_ctx: AgentCtx) -> str:
    config = await _ctx.get_core_config()

    if config.ENABLE_NEKRO_CLOUD:
        return "äº‘æœåŠ¡å·²å¯ç”¨"
    else:
        return "äº‘æœåŠ¡å·²ç¦ç”¨"
```

## ç‰¹å®šé€‚é…å™¨æ–¹æ³•

### `get_onebot_v11_bot` - è·å– OneBot V11 Bot

```python
async def get_onebot_v11_bot(self) -> OneBotV11Bot:
    """è·å– OneBot V11 Bot å®ä¾‹ï¼ˆä»…é€‚ç”¨äº OneBot V11 é€‚é…å™¨ï¼‰"""
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```python
@plugin.mount_sandbox_method(SandboxMethodType.BEHAVIOR, "send_private_msg", "å‘é€ç§èŠæ¶ˆæ¯")
async def send_private_message(_ctx: AgentCtx, user_id: int, message: str) -> str:
    if _ctx.adapter_key == "onebot_v11":
        bot = await _ctx.get_onebot_v11_bot()
        await bot.send_private_msg(user_id=user_id, message=message)
        return f"å·²å‘ç”¨æˆ· {user_id} å‘é€ç§èŠæ¶ˆæ¯"
    else:
        return "å½“å‰é€‚é…å™¨ä¸æ”¯æŒæ­¤åŠŸèƒ½"
```

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

å§‹ç»ˆæ£€æŸ¥å…³é”®å±æ€§æ˜¯å¦å­˜åœ¨ï¼š

```python
@plugin.mount_sandbox_method(SandboxMethodType.TOOL, "get_channel_info", "è·å–é¢‘é“ä¿¡æ¯")
async def get_channel_info(_ctx: AgentCtx) -> str:
    if not _ctx.channel_id:
        return "é”™è¯¯ï¼šæ— æ³•è·å–é¢‘é“ä¿¡æ¯"

    return f"é¢‘é“ID: {_ctx.channel_id}, é¢‘é“å: {_ctx.channel_name}"
```

### 2. æ–‡ä»¶è·¯å¾„å¤„ç†

ä½¿ç”¨ `fs` å·¥å…·è¿›è¡Œæ‰€æœ‰æ–‡ä»¶æ“ä½œï¼š

```python
# æ­£ç¡®çš„åšæ³•
sandbox_path = await _ctx.fs.mixed_forward_file(url, file_name="image.png")

# é”™è¯¯çš„åšæ³• - ä¸è¦ç›´æ¥è¿”å› URL æˆ–å®¿ä¸»æœºè·¯å¾„ç»™ AI
# return url  # AI å¯èƒ½ä¼šåœ¨è®¿é—®å¤–éƒ¨ URL æ—¶å‡ºç°å›°éš¾
# return "/host/path/file.png"  # AI æ— æ³•è®¿é—®å®¿ä¸»æœºè·¯å¾„
```

### 3. æ¶ˆæ¯è®°å½•æ§åˆ¶

å¯¹äºä»…é¢å‘ç”¨æˆ·æç¤ºæ€§æ¶ˆæ¯ï¼Œå¯ä»¥è®¾ç½® `record=False`ï¼š

```python
# è¿›åº¦æç¤ºæ¶ˆæ¯ä¸è®°å½•åˆ° AI å¯¹è¯ä¸Šä¸‹æ–‡
await _ctx.send_text("æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...", record=False)

# éœ€è¦ AI å‚ä¸æˆ–çŸ¥æ™“ç»“æœçš„æç¤ºæ€§æ¶ˆæ¯è®°å½•åˆ° AI å¯¹è¯ä¸Šä¸‹æ–‡
await _ctx.send_text("å¤„ç†å®Œæˆï¼ç»“æœå¦‚ä¸‹ï¼š...", record=True)
```

### 4. é€‚é…å™¨å…¼å®¹æ€§

åœ¨ä½¿ç”¨ç‰¹å®šé€‚é…å™¨åŠŸèƒ½å‰æ£€æŸ¥é€‚é…å™¨ç±»å‹ï¼š

```python
if _ctx.adapter_key == "onebot_v11":
    # ä½¿ç”¨ OneBot V11 ç‰¹å®šåŠŸèƒ½
    bot = await _ctx.get_onebot_v11_bot()
    # ...
else:
    # ä½¿ç”¨é€šç”¨åŠŸèƒ½
    await _ctx.send_text("æ­¤åŠŸèƒ½éœ€è¦ OneBot V11 é€‚é…å™¨")
```

### 5. ä¸»åŠ¨è§¦å‘ AI å“åº”çš„ä½¿ç”¨åœºæ™¯

åˆç†ä½¿ç”¨ `push_system` å’Œ `trigger_agent=True` å‚æ•°ï¼š

```python
# âœ… é€‚åˆè§¦å‘ AI çš„åœºæ™¯ï¼š

# 1. å¼‚æ­¥æ•°æ®å¤„ç†å®Œæˆï¼Œéœ€è¦ AI åˆ†æç»“æœ
await _ctx.push_system("æ•°æ®é‡‡é›†å®Œæˆï¼Œè¯·åˆ†æè¶‹åŠ¿...", trigger_agent=True)

# 2. è·¨èŠå¤©é¢‘é“äº‹ä»¶é€šçŸ¥
await _ctx.ms.push_system(other_chat, "æ”¶åˆ°ç´§æ€¥äº‹ä»¶ï¼Œéœ€è¦å¤„ç†å»ºè®®", _ctx, trigger_agent=True)

# 3. å®šæ—¶ä»»åŠ¡è§¦å‘ AI æ±‡æ€»
await _ctx.push_system("æ—¥æŠ¥æ•°æ®å·²å‡†å¤‡å°±ç»ªï¼Œè¯·ç”Ÿæˆæ€»ç»“", trigger_agent=True)

# 4. Webhook äº‹ä»¶éœ€è¦ AI å“åº”
await _ctx.push_system("å¤–éƒ¨ç³»ç»ŸçŠ¶æ€å˜æ›´ï¼Œè¯·è¯„ä¼°å½±å“", trigger_agent=True)

# âŒ ä¸é€‚åˆè§¦å‘ AI çš„åœºæ™¯ï¼š
# - çº¯çŠ¶æ€é€šçŸ¥æˆ–æ—¥å¿—è®°å½•
await _ctx.push_system("æ’ä»¶çŠ¶æ€æ›´æ–°å®Œæˆ", trigger_agent=False)

# - ç®€å•çš„ç”¨æˆ·æ“ä½œç¡®è®¤
await _ctx.push_system("æ“ä½œå·²å®Œæˆ", trigger_agent=False)
```

**æ³¨æ„äº‹é¡¹ï¼š**

- `trigger_agent=True` ä¼šæ¶ˆè€— AI æ¨¡å‹è°ƒç”¨é…é¢ï¼Œè¯·åˆç†ä½¿ç”¨
- ä¸»è¦ç”¨äºå¼‚æ­¥è§¦å‘ï¼ˆå®šæ—¶ä»»åŠ¡ã€Webhook ç­‰ï¼‰å’Œè·¨èŠå¤©åº”ç”¨åœºæ™¯
- é¿å…åœ¨åŒä¸€ä¸ªæ‰§è¡Œæµç¨‹ä¸­è‡ªè§¦å‘ï¼Œé˜²æ­¢å¾ªç¯è°ƒç”¨
- ç¡®ä¿æ¨é€çš„æ¶ˆæ¯å†…å®¹èƒ½å¤Ÿä¸º AI æä¾›æœ‰ä»·å€¼çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

é€šè¿‡åˆç†ä½¿ç”¨ `AgentCtx`ï¼Œæ’ä»¶å¯ä»¥ä¸ Nekro Agent çš„å„ä¸ªç»„ä»¶æ— ç¼é›†æˆï¼Œæä¾›å¼ºå¤§è€Œç¨³å®šçš„åŠŸèƒ½æ‰©å±•ã€‚
